<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>GreenSort AI üå±</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --accent:#00e676;--accent2:#69f0ae;--accent3:#00c853;
  --bg:#0a0f0a;--bg2:#111811;--bg3:#161e16;--card:#1a241a;--card2:#1e2a1e;
  --txt:#f0f7f0;--txt2:#a0c4a0;--txt3:#5a7a5a;
  --border:rgba(0,230,118,0.12);--border2:rgba(0,230,118,0.22);
  --glow:rgba(0,230,118,0.18);--glow2:rgba(0,230,118,0.08);
  --radius:20px;--rsm:14px;--trans:0.25s cubic-bezier(0.4,0,0.2,1);
}
[data-theme=light]{
  --bg:#c8dfc8;--bg2:#bdd6bd;--bg3:#b0ccb0;--card:#d8ecd8;--card2:#cfe6cf;
  --txt:#0d1f0d;--txt2:#1e4a1e;--txt3:#4a7a4a;
  --border:rgba(0,100,40,0.18);--border2:rgba(0,100,40,0.32);
  --glow:rgba(0,150,60,0.15);--glow2:rgba(0,150,60,0.08);
  --accent:#007a30;--accent2:#009a3c;--accent3:#005520;
}
body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--txt);min-height:100vh;transition:background var(--trans),color var(--trans);-webkit-font-smoothing:antialiased;overflow-x:hidden;}
.app{max-width:430px;margin:0 auto;padding:0 0 80px;}

.header{position:relative;padding:48px 20px 36px;text-align:center;overflow:hidden;}
.header-bg{position:absolute;inset:0;background:radial-gradient(ellipse 100% 85% at 50% 0%,rgba(0,230,118,0.28) 0%,transparent 70%);pointer-events:none;}
.header-grid{position:absolute;inset:0;background-image:linear-gradient(rgba(0,230,118,0.18) 1px,transparent 1px),linear-gradient(90deg,rgba(0,230,118,0.18) 1px,transparent 1px);background-size:32px 32px;pointer-events:none;-webkit-mask-image:linear-gradient(to bottom,black 0%,transparent 100%);mask-image:linear-gradient(to bottom,black 0%,transparent 100%);}
.logo-ring{position:relative;width:72px;height:72px;margin:0 auto 16px;display:flex;align-items:center;justify-content:center;}
.logo-ring::before{content:'';position:absolute;inset:0;border-radius:50%;border:1.5px solid var(--accent);opacity:0.5;animation:ringPulse 2.5s ease-in-out infinite;}
.logo-ring::after{content:'';position:absolute;inset:6px;border-radius:50%;border:1px solid var(--accent);opacity:0.25;animation:ringPulse 2.5s ease-in-out infinite 0.4s;}
.logo-inner{width:52px;height:52px;background:linear-gradient(135deg,rgba(0,230,118,0.2),rgba(0,200,83,0.1));border:1px solid var(--border2);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.6rem;backdrop-filter:blur(10px);box-shadow:0 0 20px var(--glow);}
@keyframes ringPulse{0%,100%{transform:scale(1);opacity:0.5}50%{transform:scale(1.08);opacity:0.15}}
.brand{font-size:1.9rem;font-weight:900;letter-spacing:-1.2px;background:linear-gradient(135deg,#fff 30%,var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
[data-theme=light] .brand{background:linear-gradient(135deg,#0d2e0d 30%,var(--accent3));-webkit-background-clip:text;background-clip:text;}
.brand-sub{font-size:0.78rem;font-weight:500;color:var(--txt3);letter-spacing:2px;text-transform:uppercase;margin-top:2px;}
.status-pill{display:inline-flex;align-items:center;gap:6px;background:var(--card);border:1px solid var(--border2);border-radius:30px;padding:6px 14px;font-size:0.7rem;font-weight:600;color:var(--accent2);margin-top:14px;box-shadow:0 0 16px var(--glow2);}
.pulse-dot{width:6px;height:6px;border-radius:50%;background:var(--accent);box-shadow:0 0 8px var(--accent);animation:blink 1.6s infinite;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.3}}

.main{padding:0 14px;}
.sec-head{display:flex;align-items:center;gap:8px;margin-bottom:10px;margin-top:22px;}
.sec-dot{width:5px;height:5px;border-radius:50%;background:var(--accent);box-shadow:0 0 6px var(--accent);}
.sec-title{font-size:0.65rem;font-weight:700;color:var(--txt3);letter-spacing:1.8px;text-transform:uppercase;}
.sec-line{flex:1;height:1px;background:linear-gradient(90deg,var(--border2),transparent);}

.upload-zone{position:relative;width:100%;aspect-ratio:4/3;background:var(--card);border:1.5px dashed var(--border2);border-radius:var(--radius);overflow:hidden;cursor:pointer;transition:all var(--trans);}
.upload-zone:hover{border-color:var(--accent);box-shadow:0 0 24px var(--glow);}
.upload-zone.has-img{border-style:solid;border-color:var(--accent);box-shadow:0 0 28px var(--glow);}
.uz-inner{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;transition:opacity var(--trans);}
.uz-icon-box{width:56px;height:56px;border-radius:16px;background:rgba(0,230,118,0.08);border:1px solid var(--border2);display:flex;align-items:center;justify-content:center;font-size:1.6rem;}
.uz-text{font-size:0.9rem;font-weight:600;color:var(--txt2);}
.uz-sub{font-size:0.72rem;color:var(--txt3);}
#previewImg{display:none;width:100%;height:100%;object-fit:cover;position:absolute;inset:0;}
.img-overlay{display:none;position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,0.7) 0%,transparent 50%);align-items:flex-end;justify-content:flex-end;padding:12px;gap:8px;}
.ov-btn{border:1px solid rgba(255,255,255,0.3);border-radius:20px;padding:7px 14px;font-size:0.72rem;font-weight:600;cursor:pointer;backdrop-filter:blur(8px);color:#fff;transition:all var(--trans);}
.ov-change{background:rgba(255,255,255,0.15);}
.ov-change:hover{background:rgba(255,255,255,0.28);}
.ov-clear{background:rgba(220,50,50,0.6);}
.ov-clear:hover{background:rgba(220,50,50,0.85);}
.upload-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px;}
.up-btn{padding:15px 10px;background:var(--card);border:1px solid var(--border);border-radius:var(--rsm);color:var(--txt2);cursor:pointer;transition:all var(--trans);display:flex;flex-direction:column;align-items:center;gap:6px;}
.up-btn:hover{border-color:var(--border2);transform:translateY(-2px);box-shadow:0 8px 24px var(--glow2);}
.up-btn:active{transform:scale(0.97);}
.up-ico{font-size:1.5rem;}
.up-lbl{font-size:0.76rem;font-weight:600;color:var(--txt2);}
.btn-analyze{width:100%;margin-top:12px;padding:17px;background:linear-gradient(135deg,var(--accent),var(--accent3));color:#050f05;font-size:0.95rem;font-weight:800;border:none;border-radius:var(--radius);cursor:pointer;transition:all var(--trans);display:flex;align-items:center;justify-content:center;gap:9px;box-shadow:0 6px 24px rgba(0,230,118,0.3);position:relative;overflow:hidden;}
.btn-analyze::after{content:'';position:absolute;top:0;left:-100%;width:60%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.25),transparent);transition:left 0.6s;}
.btn-analyze:hover:not(:disabled)::after{left:140%;}
.btn-analyze:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 10px 32px rgba(0,230,118,0.45);}
.btn-analyze:disabled{opacity:0.3;cursor:not-allowed;}
.err-box{display:none;margin-top:10px;padding:12px 14px;background:rgba(200,40,40,0.1);border:1px solid rgba(200,40,40,0.3);border-radius:var(--rsm);font-size:0.78rem;color:#ff6b6b;line-height:1.6;}

.scan-card{display:none;background:var(--card);border:1px solid var(--border2);border-radius:var(--radius);padding:24px 20px;margin-top:14px;}
.scan-steps-list{display:flex;flex-direction:column;gap:10px;margin-bottom:18px;}
.scan-step-row{display:flex;align-items:center;gap:12px;opacity:0.3;transition:opacity 0.4s;}
.scan-step-row.active{opacity:1;}
.scan-step-row.done{opacity:0.55;}
.scan-step-ico{width:32px;height:32px;border-radius:50%;border:1.5px solid var(--border2);display:flex;align-items:center;justify-content:center;font-size:0.85rem;flex-shrink:0;background:var(--bg3);}
.scan-step-row.active .scan-step-ico{border-color:var(--accent);background:rgba(0,230,118,0.1);box-shadow:0 0 10px var(--glow);}
.scan-step-row.done .scan-step-ico{border-color:var(--accent3);background:rgba(0,200,83,0.12);}
.scan-step-txt{font-size:0.8rem;font-weight:600;color:var(--txt2);}
.scan-step-row.active .scan-step-txt{color:var(--txt);}
.prog-bg{background:var(--bg3);border-radius:20px;height:5px;overflow:hidden;}
.prog-bar{height:100%;width:0%;background:linear-gradient(90deg,var(--accent2),var(--accent));border-radius:20px;transition:width 0.15s linear;}
.scan-mode-badge{display:inline-flex;align-items:center;gap:5px;margin-top:10px;padding:4px 10px;border-radius:20px;font-size:0.65rem;font-weight:700;letter-spacing:0.5px;}
.badge-ai{background:rgba(0,230,118,0.12);border:1px solid rgba(0,230,118,0.3);color:var(--accent2);}
.badge-sim{background:rgba(255,180,0,0.1);border:1px solid rgba(255,180,0,0.3);color:#ffc107;}

.detect-card{display:none;margin-top:12px;padding:14px 16px;background:var(--card);border:1px solid var(--border2);border-radius:var(--rsm);animation:slideUp 0.3s ease;}
.detect-label{font-size:0.6rem;font-weight:700;color:var(--txt3);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;}
.detect-obj{font-size:1.1rem;font-weight:800;color:var(--accent2);display:flex;align-items:center;gap:8px;}
.detect-arrow{display:flex;align-items:center;gap:8px;margin-top:8px;font-size:0.75rem;color:var(--txt3);}
.detect-cat-chip{padding:3px 10px;border-radius:20px;font-size:0.7rem;font-weight:700;background:rgba(0,230,118,0.12);border:1px solid var(--border2);color:var(--accent2);}

#resultSection{display:none;}
.result-card{border-radius:var(--radius);overflow:hidden;box-shadow:0 12px 40px rgba(0,0,0,0.4);animation:slideUp 0.4s cubic-bezier(0.34,1.56,0.64,1);}
@keyframes slideUp{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}
.res-top{padding:28px 20px 24px;text-align:center;position:relative;overflow:hidden;}
.res-icon-hex{width:68px;height:68px;margin:0 auto 12px;background:rgba(255,255,255,0.15);border:1.5px solid rgba(255,255,255,0.3);border-radius:20px;display:flex;align-items:center;justify-content:center;font-size:2.2rem;position:relative;z-index:1;}
.res-chip{display:inline-flex;align-items:center;gap:5px;background:rgba(255,255,255,0.15);border:1px solid rgba(255,255,255,0.25);border-radius:20px;padding:4px 12px;font-size:0.62rem;font-weight:700;letter-spacing:1px;color:rgba(255,255,255,0.85);margin-bottom:8px;position:relative;z-index:1;}
.res-catname{font-size:1.5rem;font-weight:900;color:#fff;letter-spacing:-0.5px;position:relative;z-index:1;}
.cat-organic  .res-top{background:linear-gradient(145deg,#0d3b10,#1b6e20,#2ea040);}
.cat-recycle  .res-top{background:linear-gradient(145deg,#01325b,#0260a0,#0288d1);}
.cat-hazard   .res-top{background:linear-gradient(145deg,#5b0000,#9c1010,#c62828);}
.cat-general  .res-top{background:linear-gradient(145deg,#1a2028,#2e3a48,#46606e);}
.cat-notwaste .res-top{background:linear-gradient(145deg,#1a1a2e,#2a2a4a,#3a3a6e);}
.cat-notwaste .conf-num{color:#7986cb;}
.cat-notwaste .conf-fill{background:linear-gradient(90deg,#5c6bc0,#7986cb);}
.cat-notwaste .ai-note{border-left-color:#7986cb;}
.res-body{background:var(--card2);padding:16px 14px;}
.res-grid{display:flex;flex-direction:column;gap:8px;}
.res-item{display:flex;align-items:flex-start;gap:12px;padding:12px 13px;background:var(--card);border:1px solid var(--border);border-radius:var(--rsm);}
.res-item-ico{width:34px;height:34px;border-radius:10px;background:rgba(0,230,118,0.08);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:1rem;flex-shrink:0;}
.res-lbl{font-size:0.6rem;font-weight:700;color:var(--txt3);text-transform:uppercase;letter-spacing:0.8px;margin-bottom:2px;}
.res-val{font-size:0.88rem;font-weight:600;color:var(--txt);line-height:1.4;}
.conf-block{margin-top:8px;padding:13px 14px;background:var(--card);border:1px solid var(--border);border-radius:var(--rsm);}
.conf-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
.conf-lbl{font-size:0.68rem;font-weight:700;color:var(--txt3);text-transform:uppercase;letter-spacing:0.8px;}
.conf-num{font-size:1.05rem;font-weight:900;color:var(--accent);}
.conf-track{height:6px;background:var(--bg3);border-radius:20px;overflow:hidden;}
.conf-fill{height:100%;border-radius:20px;background:linear-gradient(90deg,var(--accent2),var(--accent));transition:width 1.2s cubic-bezier(0.4,0,0.2,1);}
.ai-note{margin-top:8px;padding:12px 14px;background:linear-gradient(135deg,rgba(0,230,118,0.06),transparent);border-left:2px solid var(--accent);border-radius:var(--rsm);font-size:0.76rem;color:var(--txt2);line-height:1.65;}
.mode-tag{margin-top:8px;display:flex;justify-content:flex-end;}

.cat-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.cat-card{background:var(--card);border:1px solid var(--border);border-radius:var(--rsm);padding:14px 12px;transition:all var(--trans);cursor:pointer;}
.cat-card:hover{border-color:var(--border2);transform:translateY(-3px);box-shadow:0 8px 24px var(--glow2);}
.cat-ico-wrap{width:38px;height:38px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.3rem;margin-bottom:8px;}
.cat-name{font-size:0.8rem;font-weight:700;margin-bottom:3px;}
.cat-ex{font-size:0.66rem;color:var(--txt3);line-height:1.5;}
.c-organic .cat-ico-wrap{background:rgba(46,160,64,0.12);}
.c-recycle .cat-ico-wrap{background:rgba(2,136,209,0.12);}
.c-hazard  .cat-ico-wrap{background:rgba(198,40,40,0.12);}
.c-general .cat-ico-wrap{background:rgba(70,96,110,0.12);}

.cat-modal-bg{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);backdrop-filter:blur(4px);z-index:100;align-items:center;justify-content:center;padding:20px;}
.cat-modal-bg.open{display:flex;}
.cat-modal{background:var(--card);border:1px solid var(--border2);border-radius:24px;width:100%;max-width:340px;overflow:hidden;animation:slideUp 0.3s cubic-bezier(0.34,1.56,0.64,1);box-shadow:0 20px 60px rgba(0,0,0,0.5);}
.cat-modal-top{padding:24px 20px 16px;text-align:center;position:relative;}
.cat-modal-ico{font-size:3rem;margin-bottom:10px;}
.cat-modal-name{font-size:1.3rem;font-weight:900;color:#fff;}
.cat-modal-close{position:absolute;top:14px;right:14px;width:30px;height:30px;border-radius:50%;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:0.9rem;color:#fff;}
.cat-modal-body{padding:16px 16px 20px;display:flex;flex-direction:column;gap:10px;}
.cat-modal-section{background:var(--card2);border:1px solid var(--border);border-radius:14px;padding:12px 14px;}
.cat-modal-slbl{font-size:0.58rem;font-weight:700;color:var(--txt3);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;}
.cat-modal-sval{font-size:0.82rem;color:var(--txt2);line-height:1.6;}
.cat-modal-tags{display:flex;flex-wrap:wrap;gap:6px;margin-top:4px;}
.cat-tag{padding:4px 10px;border-radius:20px;font-size:0.68rem;font-weight:600;border:1px solid var(--border2);color:var(--txt2);background:var(--bg3);}

.how-wrap{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;}
.how-item{display:flex;align-items:center;gap:14px;padding:14px 16px;border-bottom:1px solid var(--border);transition:all var(--trans);}
.how-item:last-child{border-bottom:none;}
.how-item:hover{background:var(--card2);padding-left:20px;}
.how-num{min-width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent3));color:#050f05;font-size:0.78rem;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.how-text{font-size:0.82rem;font-weight:500;color:var(--txt2);}

.settings-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;}
.setting-row{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border);}
.setting-row:last-child{border-bottom:none;}
.setting-row:hover{background:var(--card2);}
.setting-left{display:flex;align-items:center;gap:10px;}
.setting-ico{width:34px;height:34px;border-radius:10px;background:rgba(0,230,118,0.08);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:1rem;flex-shrink:0;}
.setting-name{font-size:0.84rem;font-weight:700;color:var(--txt);}
.setting-desc{font-size:0.66rem;color:var(--txt3);margin-top:1px;}
.seg-ctrl{display:flex;background:var(--bg3);border:1px solid var(--border);border-radius:20px;padding:3px;gap:2px;}
.seg-btn{padding:5px 13px;border-radius:16px;font-size:0.72rem;font-weight:700;color:var(--txt3);cursor:pointer;transition:all var(--trans);user-select:none;white-space:nowrap;}
.seg-btn.active{background:var(--accent);color:#0a0f0a;box-shadow:0 2px 10px rgba(0,230,118,0.35);}

footer{text-align:center;padding:24px 16px 12px;}
.footer-txt{font-size:0.68rem;color:var(--txt3);}
</style>
</head>
<body data-theme="dark">
<div class="app">

<div class="header">
  <div class="header-bg"></div><div class="header-grid"></div>
  <div class="logo-ring"><div class="logo-inner">üå±</div></div>
  <div class="brand">GreenSort AI üå±</div>
  <div class="brand-sub" id="brandSub">Ph√¢n Lo·∫°i R√°c B·∫±ng AI</div>
  <div class="status-pill"><span class="pulse-dot"></span><span id="poweredTxt">H·ªó tr·ª£ b·ªüi AI</span></div>
</div>

<div class="main">
  <div class="sec-head"><span class="sec-dot"></span><span class="sec-title" id="secImg">·∫¢NH</span><span class="sec-line"></span></div>
  <div class="upload-zone" id="uploadZone">
    <div class="uz-inner" id="uzInner">
      <div class="uz-icon-box">üìÇ</div>
      <div class="uz-text" id="uzTitle">Ch·∫°m ƒë·ªÉ ch·ªçn ·∫£nh</div>
      <div class="uz-sub">JPG ¬∑ PNG ¬∑ WEBP</div>
    </div>
    <img id="previewImg" alt="preview">
    <div class="img-overlay" id="imgOverlay">
      <button class="ov-btn ov-change" id="btnChange">üîÑ ƒê·ªïi</button>
      <button class="ov-btn ov-clear" id="btnClear">üóë X√≥a</button>
    </div>
  </div>
  <input type="file" id="fileInput" accept="image/*" style="display:none">
  <input type="file" id="fileCam" accept="image/*" capture="environment" style="display:none">
  <div class="err-box" id="errBox"></div>
  <button class="btn-analyze" id="btnAnalyze" disabled>
    <span>üå±</span><span id="lblAnalyze">Ph√¢n T√≠ch B·∫±ng AI</span>
  </button>

  <div class="scan-card" id="scanCard">
    <div class="scan-steps-list" id="scanStepsList"></div>
    <div class="prog-bg"><div class="prog-bar" id="scanBar"></div></div>
    <div style="text-align:center"><span class="scan-mode-badge badge-ai" id="modeBadge">ü§ñ GreenSort AI Vision</span></div>
  </div>

  <div class="detect-card" id="detectCard">
    <div class="detect-label" id="detectLabel">NH·∫¨N DI·ªÜN V·∫¨T TH·ªÇ</div>
    <div class="detect-obj" id="detectObj"></div>
    <div class="detect-arrow">
      <span>‚Ü≥</span>
      <span id="detectMapping"></span>
      <span class="detect-cat-chip" id="detectCatChip"></span>
    </div>
  </div>

  <div id="resultSection">
    <div class="sec-head" style="margin-top:22px;"><span class="sec-dot"></span><span class="sec-title" id="secResult">K·∫æT QU·∫¢ AI</span><span class="sec-line"></span></div>
    <div class="result-card" id="resultCard">
      <div class="res-top">
        <div class="res-icon-hex" id="rIcon"></div>
        <div class="res-chip">üå± <span id="aiBadge">ƒê√É PH√ÇN LO·∫†I</span></div>
        <div class="res-catname" id="rCatName"></div>
      </div>
      <div class="res-body">
        <div class="res-grid">
          <div class="res-item"><div class="res-item-ico">üîç</div><div><div class="res-lbl" id="lblObj">V·∫¨T NH·∫¨N DI·ªÜN</div><div class="res-val" id="rObj"></div></div></div>
          <div class="res-item"><div class="res-item-ico">üß™</div><div><div class="res-lbl" id="lblMat">CH·∫§T LI·ªÜU</div><div class="res-val" id="rMat"></div></div></div>
          <div class="res-item"><div class="res-item-ico">üóë</div><div><div class="res-lbl" id="lblCat">PH√ÇN LO·∫†I R√ÅC</div><div class="res-val" id="rCat"></div></div></div>
          <div class="res-item"><div class="res-item-ico">üìã</div><div><div class="res-lbl" id="lblInstr">H∆Ø·ªöNG D·∫™N</div><div class="res-val" id="rInstr"></div></div></div>
        </div>
        <div class="conf-block">
          <div class="conf-row"><span class="conf-lbl" id="lblConf">ƒê·ªò CH√çNH X√ÅC</span><span class="conf-num" id="confPct"></span></div>
          <div class="conf-track"><div class="conf-fill" id="confBar"></div></div>
        </div>
        <div class="ai-note" id="aiNote"></div>
        <div class="mode-tag" id="modeTag"></div>
      </div>
    </div>
  </div>

  <div class="sec-head" style="margin-top:22px;"><span class="sec-dot"></span><span class="sec-title" id="secTypes">LO·∫†I R√ÅC</span><span class="sec-line"></span></div>
  <div class="cat-grid" id="catGrid"></div>

  <div class="cat-modal-bg" id="catModalBg">
    <div class="cat-modal">
      <div class="cat-modal-top" id="catModalTop">
        <div class="cat-modal-ico" id="catModalIco"></div>
        <div class="cat-modal-name" id="catModalName"></div>
        <div class="cat-modal-close" id="catModalClose">‚úï</div>
      </div>
      <div class="cat-modal-body" id="catModalBody"></div>
    </div>
  </div>

  <div class="sec-head" style="margin-top:22px;"><span class="sec-dot"></span><span class="sec-title" id="secHow">H∆Ø·ªöNG D·∫™N</span><span class="sec-line"></span></div>
  <div class="how-wrap" id="howWrap"></div>

  <div class="sec-head" style="margin-top:22px;"><span class="sec-dot"></span><span class="sec-title" id="secSettings">C√ÄI ƒê·∫∂T</span><span class="sec-line"></span></div>
  <div class="settings-card">
    <div class="setting-row">
      <div class="setting-left">
        <div class="setting-ico">üåê</div>
        <div><div class="setting-name" id="settingLangName">Ng√¥n Ng·ªØ</div><div class="setting-desc" id="settingLangDesc">Ng√¥n ng·ªØ hi·ªÉn th·ªã</div></div>
      </div>
      <div class="seg-ctrl"><div class="seg-btn active" id="segVI">VI</div><div class="seg-btn" id="segEN">EN</div></div>
    </div>
    <div class="setting-row">
      <div class="setting-left">
        <div class="setting-ico">üé®</div>
        <div><div class="setting-name" id="settingThemeName">Giao Di·ªán</div><div class="setting-desc" id="settingThemeDesc">M√†u s·∫Øc ·ª©ng d·ª•ng</div></div>
      </div>
      <div class="seg-ctrl"><div class="seg-btn active" id="segDark">‚òæ Dark</div><div class="seg-btn" id="segLight">‚òÄ Light</div></div>
    </div>
  </div>

  <div class="sec-head" style="margin-top:22px;"><span class="sec-dot"></span><span class="sec-title" id="secDev">NH√Ä PH√ÅT TRI·ªÇN</span><span class="sec-line"></span></div>
  <div style="display:flex;flex-direction:column;gap:10px;">
    <div class="dev-member-card" data-dev="MB" style="display:flex;align-items:center;gap:9px;background:var(--card);border:1px solid var(--border);border-radius:10px;padding:9px 12px;cursor:pointer;transition:all var(--trans);">
      <div style="width:24px;height:24px;border-radius:7px;background:linear-gradient(135deg,#00c853,#00e676);display:flex;align-items:center;justify-content:center;font-size:0.58rem;font-weight:900;color:#050f05;flex-shrink:0;">MB</div>
      <div style="font-size:0.82rem;font-weight:700;color:var(--accent2);">Mai Th·∫ø B√°ch</div>
      <div id="devRole1" style="margin-left:auto;font-size:0.72rem;color:var(--txt2);">Tr∆∞·ªüng nh√≥m &amp; L·∫≠p tr√¨nh</div>
    </div>
    <div class="dev-member-card" data-dev="QD" style="display:flex;align-items:center;gap:9px;background:var(--card);border:1px solid var(--border);border-radius:10px;padding:9px 12px;cursor:pointer;transition:all var(--trans);">
      <div style="width:24px;height:24px;border-radius:7px;background:linear-gradient(135deg,#0288d1,#29b6f6);display:flex;align-items:center;justify-content:center;font-size:0.58rem;font-weight:900;color:#fff;flex-shrink:0;">QD</div>
      <div style="font-size:0.82rem;font-weight:700;color:#29b6f6;">Tr·∫ßn Quang D≈©ng</div>
      <div id="devRole2" style="margin-left:auto;font-size:0.72rem;color:var(--txt2);">Thi·∫øt k·∫ø UI/UX</div>
    </div>
    <div class="dev-member-card" data-dev="VT" style="display:flex;align-items:center;gap:9px;background:var(--card);border:1px solid var(--border);border-radius:10px;padding:9px 12px;cursor:pointer;transition:all var(--trans);">
      <div style="width:24px;height:24px;border-radius:7px;background:linear-gradient(135deg,#c62828,#ef5350);display:flex;align-items:center;justify-content:center;font-size:0.58rem;font-weight:900;color:#fff;flex-shrink:0;">VT</div>
      <div style="font-size:0.82rem;font-weight:700;color:#ef9a9a;">L∆∞u Vi·ªát T√πng</div>
      <div id="devRole3" style="margin-left:auto;font-size:0.72rem;color:var(--txt2);">Ph√¢n t√≠ch d·ªØ li·ªáu &amp; AI</div>
    </div>
    <div class="dev-member-card" data-dev="ST" style="display:flex;align-items:center;gap:9px;background:var(--card);border:1px solid var(--border);border-radius:10px;padding:9px 12px;cursor:pointer;transition:all var(--trans);">
      <div style="width:24px;height:24px;border-radius:7px;background:linear-gradient(135deg,#37474f,#607d8b);display:flex;align-items:center;justify-content:center;font-size:0.72rem;flex-shrink:0;">üå±</div>
      <div style="font-size:0.82rem;font-weight:700;color:#90a4ae;">GreenSort AI</div>
      <div style="margin-left:auto;font-size:0.72rem;color:var(--txt2);">ƒê·ªì √°n 2026</div>
    </div>
  </div>
</div>

<footer><div class="footer-txt" id="footerTxt">H·ªó tr·ª£ b·ªüi AI ¬∑ GreenSort AI üå± ¬∑ B·∫£o v·ªá m√¥i tr∆∞·ªùng üåç</div></footer>
</div>

<script>
var TEXTS = {
  en:{
    brandSub:'AI Waste Classification',poweredTxt:'Powered by AI',
    secImg:'IMAGE',uzTitle:'Tap to select image',lblCamera:'Camera',lblAlbum:'Album',
    lblAnalyze:'Analyze with GreenSort AI',secResult:'AI RESULT',aiBadge:'GREENSORT CLASSIFIED',
    lblObj:'DETECTED OBJECT',lblMat:'MATERIAL',lblCat:'WASTE CATEGORY',lblInstr:'INSTRUCTION',lblConf:'AI CONFIDENCE',
    secTypes:'WASTE CATEGORIES',secHow:'HOW TO USE',secSettings:'SETTINGS',secDev:'DEVELOPERS',
    settingLangName:'Language',settingLangDesc:'Display language',
    settingThemeName:'Theme',settingThemeDesc:'App appearance',
    devRole1:'Team Lead & Developer',devRole2:'UI/UX Designer',devRole3:'Data & AI Analysis',
    footerTxt:'Powered by AI ¬∑ GreenSort AI üå± ¬∑ Protect our Earth üåç ¬∑ ¬© 2026',
    btnChange:'Change',btnClear:'Clear',
    detectLabel:'OBJECT DETECTED',
    detectMapping:'Mapping to category ‚Üí',
    scanSteps:[
      {ico:'üì°',txt:'Sending image to GreenSort AI...'},
      {ico:'üîç',txt:'Detecting object in image...'},
      {ico:'üß™',txt:'Analyzing material & composition...'},
      {ico:'‚ôªÔ∏è',txt:'Classifying waste category...'},
      {ico:'üìã',txt:'Generating disposal instructions...'}
    ],
    steps:['Open camera or select an image','Point at the waste item','Wait for GreenSort AI to analyze','Dispose waste in the correct bin'],
    types:[
      {cls:'c-organic',icon:'üåø',name:'Organic',    color:'#00c853',ex:'Food waste, Fruit peel, Leaves'},
      {cls:'c-recycle',icon:'‚ôªÔ∏è',name:'Recyclable', color:'#0288d1',ex:'Plastic, Paper, Metal, Glass'},
      {cls:'c-hazard', icon:'‚ö†Ô∏è',name:'Hazardous',  color:'#ef5350',ex:'Battery, Light bulb, Chemicals'},
      {cls:'c-general',icon:'üóëÔ∏è',name:'General',    color:'#78909c',ex:'Ceramic, Foam, Mixed waste'}
    ],
    simFallback:'‚ö†Ô∏è AI unavailable ‚Äì simulation mode',
    aiReal:'üå± GreenSort AI Vision'
  },
  vi:{
    brandSub:'Ph√¢n Lo·∫°i R√°c B·∫±ng AI',poweredTxt:'H·ªó tr·ª£ b·ªüi AI',
    secImg:'·∫¢NH',uzTitle:'Ch·∫°m ƒë·ªÉ ch·ªçn ·∫£nh',lblCamera:'Camera',lblAlbum:'Album',
    lblAnalyze:'Ph√¢n T√≠ch B·∫±ng GreenSort AI',secResult:'K·∫æT QU·∫¢ AI',aiBadge:'GREENSORT ƒê√É PH√ÇN LO·∫†I',
    lblObj:'V·∫¨T NH·∫¨N DI·ªÜN',lblMat:'CH·∫§T LI·ªÜU',lblCat:'PH√ÇN LO·∫†I R√ÅC',lblInstr:'H∆Ø·ªöNG D·∫™N',lblConf:'ƒê·ªò CH√çNH X√ÅC',
    secTypes:'LO·∫†I R√ÅC',secHow:'H∆Ø·ªöNG D·∫™N',secSettings:'C√ÄI ƒê·∫∂T',secDev:'NH√Ä PH√ÅT TRI·ªÇN',
    settingLangName:'Ng√¥n Ng·ªØ',settingLangDesc:'Ng√¥n ng·ªØ hi·ªÉn th·ªã',
    settingThemeName:'Giao Di·ªán',settingThemeDesc:'M√†u s·∫Øc ·ª©ng d·ª•ng',
    devRole1:'Tr∆∞·ªüng nh√≥m & L·∫≠p tr√¨nh',devRole2:'Thi·∫øt k·∫ø UI/UX',devRole3:'Ph√¢n t√≠ch d·ªØ li·ªáu & AI',
    footerTxt:'H·ªó tr·ª£ b·ªüi AI ¬∑ GreenSort AI üå± ¬∑ B·∫£o v·ªá m√¥i tr∆∞·ªùng üåç ¬∑ ¬© 2026',
    btnChange:'ƒê·ªïi',btnClear:'X√≥a',
    detectLabel:'V·∫¨T TH·ªÇ NH·∫¨N DI·ªÜN',
    detectMapping:'ƒêang ph√¢n lo·∫°i ‚Üí',
    scanSteps:[
      {ico:'üì°',txt:'ƒêang g·ª≠i ·∫£nh ƒë·∫øn GreenSort AI...'},
      {ico:'üîç',txt:'Nh·∫≠n di·ªán v·∫≠t th·ªÉ trong ·∫£nh...'},
      {ico:'üß™',txt:'Ph√¢n t√≠ch ch·∫•t li·ªáu & th√†nh ph·∫ßn...'},
      {ico:'‚ôªÔ∏è',txt:'Ph√¢n lo·∫°i danh m·ª•c r√°c th·∫£i...'},
      {ico:'üìã',txt:'T·∫°o h∆∞·ªõng d·∫´n x·ª≠ l√Ω r√°c...'}
    ],
    steps:['M·ªü camera ho·∫∑c ch·ªçn ·∫£nh','H∆∞·ªõng v√†o v·∫≠t r√°c','Ch·ªù GreenSort AI ph√¢n t√≠ch','B·ªè r√°c ƒë√∫ng th√πng theo k·∫øt qu·∫£'],
    types:[
      {cls:'c-organic',icon:'üåø',name:'H·ªØu C∆°',       color:'#00c853',ex:'Th·ª©c ƒÉn th·ª´a, V·ªè tr√°i c√¢y'},
      {cls:'c-recycle',icon:'‚ôªÔ∏è',name:'T√°i Ch·∫ø',       color:'#0288d1',ex:'Nh·ª±a, Gi·∫•y, Kim lo·∫°i, Th·ªßy tinh'},
      {cls:'c-hazard', icon:'‚ö†Ô∏è',name:'Nguy H·∫°i',      color:'#ef5350',ex:'Pin, B√≥ng ƒë√®n, H√≥a ch·∫•t'},
      {cls:'c-general',icon:'üóëÔ∏è',name:'Kh√≥ Ph√¢n H·ªßy', color:'#78909c',ex:'G·ªëm s·ª©, X·ªëp, R√°c h·ªón h·ª£p'}
    ],
    simFallback:'‚ö†Ô∏è AI kh√¥ng kh·∫£ d·ª•ng ‚Äì ch·∫ø ƒë·ªô m√¥ ph·ªèng',
    aiReal:'üå± GreenSort AI Vision'
  }
};

var CAT_INFO = {
  en:{
    'c-organic':{bg:'linear-gradient(145deg,#0d3b10,#1b6e20,#2ea040)',color:'#2ea040',desc:'Organic waste is biodegradable material that decomposes naturally.',examples:['Food scraps','Fruit peels','Leftover rice','Leaves','Coffee grounds','Eggshells'],bin:'Brown bin or compost pile',tip:'Composting organic waste reduces landfill use by up to 30%.'},
    'c-recycle':{bg:'linear-gradient(145deg,#01325b,#0260a0,#0288d1)',color:'#0288d1',desc:'Recyclable waste can be reused to make new products.',examples:['Plastic bottles','Paper','Glass bottles','Metal cans','Aluminum foil','Newspapers'],bin:'Blue recycling bin',tip:'Rinse containers before recycling.'},
    'c-hazard' :{bg:'linear-gradient(145deg,#5b0000,#9c1010,#c62828)',color:'#ef5350',desc:'Hazardous waste contains toxic or flammable substances that harm people and environment.',examples:['Batteries','Fluorescent bulbs','Chemicals','Paint','Pesticides','Electronics'],bin:'Red hazardous waste bin',tip:'Never mix hazardous waste with regular trash.'},
    'c-general':{bg:'linear-gradient(145deg,#1a2028,#2e3a48,#46606e)',color:'#78909c',desc:'General waste cannot be easily recycled or composted.',examples:['Ceramic','Foam packaging','Dirty plastic bags','Broken mirrors','Used tissues'],bin:'Black or grey general waste bin',tip:'Reduce by choosing minimal packaging products.'}
  },
  vi:{
    'c-organic':{bg:'linear-gradient(145deg,#0d3b10,#1b6e20,#2ea040)',color:'#2ea040',desc:'R√°c h·ªØu c∆° l√† v·∫≠t li·ªáu c√≥ th·ªÉ ph√¢n h·ªßy sinh h·ªçc t·ª± nhi√™n.',examples:['Th·ª©c ƒÉn th·ª´a','V·ªè tr√°i c√¢y','C∆°m ngu·ªôi','L√° c√¢y','B√£ c√† ph√™','V·ªè tr·ª©ng'],bin:'Th√πng n√¢u ho·∫∑c ƒë·ªëng ·ªß ph√¢n',tip:'·ª¶ r√°c h·ªØu c∆° gi√∫p gi·∫£m r√°c ƒë·∫øn b√£i ch√¥n l·∫•p t·ªõi 30%.'},
    'c-recycle':{bg:'linear-gradient(145deg,#01325b,#0260a0,#0288d1)',color:'#0288d1',desc:'R√°c t√°i ch·∫ø c√≥ th·ªÉ ƒë∆∞·ª£c x·ª≠ l√Ω ƒë·ªÉ t·∫°o ra s·∫£n ph·∫©m m·ªõi.',examples:['Chai nh·ª±a','Gi·∫•y & b√¨a','Chai th·ªßy tinh','Lon kim lo·∫°i','Gi·∫•y b·∫°c nh√¥m','B√°o c≈©'],bin:'Th√πng xanh t√°i ch·∫ø',tip:'R·ª≠a s·∫°ch ƒë·ªì ƒë·ª±ng tr∆∞·ªõc khi b·ªè v√†o th√πng t√°i ch·∫ø.'},
    'c-hazard' :{bg:'linear-gradient(145deg,#5b0000,#9c1010,#c62828)',color:'#ef5350',desc:'R√°c nguy h·∫°i ch·ª©a ch·∫•t ƒë·ªôc, d·ªÖ ch√°y, c√≥ th·ªÉ g√¢y h·∫°i cho ng∆∞·ªùi v√† m√¥i tr∆∞·ªùng.',examples:['Pin','ƒê√®n hu·ª≥nh quang','H√≥a ch·∫•t','S∆°n','Thu·ªëc tr·ª´ s√¢u','Thi·∫øt b·ªã ƒëi·ªán t·ª≠'],bin:'Th√πng ƒë·ªè r√°c nguy h·∫°i',tip:'Kh√¥ng bao gi·ªù tr·ªôn r√°c nguy h·∫°i v·ªõi r√°c th∆∞·ªùng.'},
    'c-general':{bg:'linear-gradient(145deg,#1a2028,#2e3a48,#46606e)',color:'#78909c',desc:'R√°c kh√≥ ph√¢n h·ªßy kh√¥ng th·ªÉ t√°i ch·∫ø hay ·ªß ph√¢n d·ªÖ d√†ng.',examples:['G·ªëm s·ª©','X·ªëp ƒë√≥ng g√≥i','T√∫i ni-l√¥ng b·∫©n','G∆∞∆°ng v·ª°','KhƒÉn gi·∫•y ƒë√£ d√πng'],bin:'Th√πng ƒëen ho·∫∑c x√°m r√°c th∆∞·ªùng',tip:'Gi·∫£m r√°c b·∫±ng c√°ch ch·ªçn s·∫£n ph·∫©m √≠t bao b√¨.'}
  }
};

var SIM_OBJECTS = [
  {object:'Chai nh·ª±a/Plastic bottle',    material:'Nh·ª±a PET/PET Plastic',    category_vi:'Ch·∫•t th·∫£i t√°i ch·∫ø',      category_en:'Recyclable Waste',    instruction_vi:'X·∫øp v√†o th√πng t√°i ch·∫ø m√†u xanh.',          instruction_en:'Place in blue recycling bin.',       tip_vi:'L√†m s·∫°ch tr∆∞·ªõc khi b·ªè.',tip_en:'Rinse before recycling.',confidence:91},
  {object:'V·ªè chu·ªëi/Banana peel',        material:'H·ªØu c∆°/Organic',          category_vi:'Ch·∫•t th·∫£i h·ªØu c∆°',       category_en:'Organic Waste',       instruction_vi:'B·ªè v√†o th√πng ·ªß ph√¢n ho·∫∑c th√πng n√¢u.',      instruction_en:'Place in compost or brown bin.',     tip_vi:'C√≥ th·ªÉ ·ªß ph√¢n t·ªët.',tip_en:'Great for composting.',confidence:95},
  {object:'Pin c≈©/Old battery',          material:'Kim lo·∫°i & h√≥a ch·∫•t/Metal & chemicals',category_vi:'Ch·∫•t th·∫£i nguy h·∫°i', category_en:'Hazardous Waste',   instruction_vi:'B·ªè v√†o ƒëi·ªÉm thu gom pin chuy√™n d·ª•ng.',     instruction_en:'Drop off at battery collection point.',tip_vi:'Kh√¥ng bao gi·ªù v·ª©t v√†o r√°c th∆∞·ªùng.',tip_en:'Never put in regular trash.',confidence:97},
  {object:'H·ªôp x·ªëp/Foam box',            material:'X·ªëp EPS/EPS Foam',         category_vi:'Ch·∫•t th·∫£i kh√≥ ph√¢n h·ªßy',category_en:'General Waste',       instruction_vi:'B·ªè v√†o th√πng r√°c th√¥ng th∆∞·ªùng.',           instruction_en:'Place in general waste bin.',        tip_vi:'H·∫°n ch·∫ø d√πng x·ªëp.',tip_en:'Reduce foam usage.',confidence:88},
  {object:'ƒêi·ªán tho·∫°i c≈©/Old phone',     material:'Kim lo·∫°i & nh·ª±a/Metal & plastic',category_vi:'Ch·∫•t th·∫£i nguy h·∫°i',category_en:'Hazardous Waste',     instruction_vi:'Mang ƒë·∫øn ƒëi·ªÉm thu gom thi·∫øt b·ªã ƒëi·ªán t·ª≠.',  instruction_en:'Take to e-waste collection center.', tip_vi:'D·ªØ li·ªáu c·∫ßn x√≥a tr∆∞·ªõc.',tip_en:'Wipe data before disposal.',confidence:93},
  {object:'Gi·∫•y b√°o/Newspaper',          material:'Gi·∫•y/Paper',               category_vi:'Ch·∫•t th·∫£i t√°i ch·∫ø',      category_en:'Recyclable Waste',    instruction_vi:'B·ªè v√†o th√πng t√°i ch·∫ø.',                    instruction_en:'Place in recycling bin.',            tip_vi:'Gi·∫•y kh√¥ m·ªõi t√°i ch·∫ø ƒë∆∞·ª£c.',tip_en:'Keep dry for recycling.',confidence:89},
  {object:'Th·ª©c ƒÉn th·ª´a/Food scraps',    material:'H·ªØu c∆°/Organic',          category_vi:'Ch·∫•t th·∫£i h·ªØu c∆°',       category_en:'Organic Waste',       instruction_vi:'·ª¶ ph√¢n ho·∫∑c b·ªè th√πng h·ªØu c∆°.',            instruction_en:'Compost or organic bin.',            tip_vi:'Tr√°nh ƒë·ªÉ l·∫´n d·∫ßu m·ª° nhi·ªÅu.',tip_en:'Avoid excess oils/fats.',confidence:92},
  {object:'ƒê·ªì g·ªëm v·ª°/Broken ceramic',   material:'G·ªëm s·ª©/Ceramic',           category_vi:'Ch·∫•t th·∫£i kh√≥ ph√¢n h·ªßy',category_en:'General Waste',       instruction_vi:'B·ªçc k·ªπ r·ªìi b·ªè th√πng r√°c th√¥ng th∆∞·ªùng.',   instruction_en:'Wrap safely and place in general bin.',tip_vi:'B·ªçc l·∫°i ƒë·ªÉ tr√°nh th∆∞∆°ng t√≠ch.',tip_en:'Wrap to prevent injury.',confidence:86}
];

var DEV_INFO={
  MB:{bg:'linear-gradient(145deg,#0d3b10,#1b6e20,#2ea040)',avatar:'MB',name:'Mai Th·∫ø B√°ch',role_vi:'Tr∆∞·ªüng nh√≥m & L·∫≠p tr√¨nh',role_en:'Team Lead & Developer',skills:['JavaScript','HTML/CSS','AI API','Node.js'],desc_vi:'Tr∆∞·ªüng nh√≥m d·ª± √°n, ph·ª• tr√°ch ki·∫øn tr√∫c h·ªá th·ªëng v√† t√≠ch h·ª£p AI v√†o GreenSort AI.',desc_en:'Project lead, responsible for system architecture and AI integration into GreenSort AI.'},
  QD:{bg:'linear-gradient(145deg,#01325b,#0260a0,#0288d1)',avatar:'QD',name:'Tr·∫ßn Quang D≈©ng',role_vi:'Thi·∫øt k·∫ø UI/UX',role_en:'UI/UX Designer',skills:['Figma','CSS Animation','Dark Mode','Mobile UI'],desc_vi:'Ph·ª• tr√°ch thi·∫øt k·∫ø giao di·ªán ng∆∞·ªùi d√πng, tr·∫£i nghi·ªám di ƒë·ªông v√† h·ªá th·ªëng m√†u s·∫Øc c·ªßa GreenSort AI.',desc_en:'Responsible for UI design, mobile UX and the color system of GreenSort AI.'},
  VT:{bg:'linear-gradient(145deg,#5b0000,#9c1010,#c62828)',avatar:'VT',name:'L∆∞u Vi·ªát T√πng',role_vi:'Ph√¢n t√≠ch d·ªØ li·ªáu & AI',role_en:'Data & AI Analysis',skills:['AI Prompting','Data Analysis','Python','Waste Classification'],desc_vi:'Ph·ª• tr√°ch nghi√™n c·ª©u m√¥ h√¨nh AI, x√¢y d·ª±ng h·ªá th·ªëng ph√¢n lo·∫°i r√°c v√† t·ªëi ∆∞u h√≥a prompt cho GreenSort AI.',desc_en:'Responsible for AI model research, waste classification logic and prompt optimization for GreenSort AI.'},
  ST:{bg:'linear-gradient(145deg,#1a2028,#2e3a48,#46606e)',avatar:'üå±',name:'GreenSort AI',role_vi:'ƒê·ªì √°n ph√¢n lo·∫°i r√°c th·∫£i th√¥ng minh',role_en:'AI Waste Classification Project',    skills:['AI Model','Vision API','GreenSort','Bilingual'],desc_vi:'GreenSort AI ‚Äî ·ª©ng d·ª•ng ph√¢n lo·∫°i r√°c th·∫£i th√¥ng minh s·ª≠ d·ª•ng c√¥ng ngh·ªá AI Vision, nh·∫≠n di·ªán v√† ph√¢n lo·∫°i r√°c ch√≠nh x√°c.',desc_en:'GreenSort AI ‚Äî smart waste classification app using AI Vision for accurate waste detection and sorting. ¬© 2026'}
};

var lang='vi', imgBase64=null, imgMime=null;
function g(id){return document.getElementById(id);}

function applyLang(){
  var d=TEXTS[lang];
  ['brandSub','poweredTxt','secImg','uzTitle','lblAnalyze','secResult','aiBadge',
   'lblObj','lblMat','lblCat','lblInstr','lblConf','secTypes','secHow','secSettings',
   'secDev','settingLangName','settingLangDesc','settingThemeName','settingThemeDesc',
   'devRole1','devRole2','devRole3','footerTxt','btnChange','btnClear','detectLabel'].forEach(function(id){
    var el=g(id); if(el&&d[id]!==undefined) el.textContent=d[id];
  });
  g('howWrap').innerHTML=d.steps.map(function(s,i){
    return '<div class="how-item"><div class="how-num">'+(i+1)+'</div><div class="how-text">'+s+'</div></div>';
  }).join('');
  g('catGrid').innerHTML=d.types.map(function(t){
    return '<div class="cat-card '+t.cls+'" data-cls="'+t.cls+'">'+
      '<div class="cat-ico-wrap">'+t.icon+'</div>'+
      '<div class="cat-name" style="color:'+t.color+'">'+t.name+'</div>'+
      '<div class="cat-ex">'+t.ex+'</div></div>';
  }).join('');
}
function setLang(l){lang=l;g('segVI').className='seg-btn'+(l==='vi'?' active':'');g('segEN').className='seg-btn'+(l==='en'?' active':'');applyLang();}
function setTheme(t){document.body.setAttribute('data-theme',t);g('segDark').className='seg-btn'+(t==='dark'?' active':'');g('segLight').className='seg-btn'+(t==='light'?' active':'');}

function showImage(src){g('previewImg').src=src;g('previewImg').style.display='block';g('uzInner').style.opacity='0';g('imgOverlay').style.display='flex';g('uploadZone').classList.add('has-img');}
function clearImage(){imgBase64=null;imgMime=null;g('previewImg').src='';g('previewImg').style.display='none';g('uzInner').style.opacity='1';g('imgOverlay').style.display='none';g('uploadZone').classList.remove('has-img');g('fileInput').value='';g('fileCam').value='';g('btnAnalyze').disabled=true;g('resultSection').style.display='none';g('scanCard').style.display='none';g('detectCard').style.display='none';g('errBox').style.display='none';}
function showErr(msg){g('errBox').style.display='block';g('errBox').textContent=msg;}
function onFile(f){
  if(!f||f.size===0)return;
  imgMime=f.type||'image/jpeg';imgBase64=null;
  g('btnAnalyze').disabled=true;g('errBox').style.display='none';
  var r=new FileReader();
  r.onload=function(ev){
    try{
      var res=ev.target.result;
      if(!res||!res.startsWith('data:')||!res.includes(';base64,'))throw new Error('bad');
      var pts=res.split(';base64,');
      var img=new Image();
      img.onload=function(){imgBase64=pts[1];imgMime=pts[0].replace('data:','')||'image/jpeg';showImage(res);g('btnAnalyze').disabled=false;};
      img.onerror=function(){showErr(lang==='vi'?'Kh√¥ng ƒë·ªçc ƒë∆∞·ª£c ·∫£nh.':'Cannot read image.');};
      img.src=res;
    }catch(e){showErr(lang==='vi'?'Kh√¥ng ƒë·ªçc ƒë∆∞·ª£c ·∫£nh.':'Cannot read image.');}
  };
  r.onerror=function(){showErr(lang==='vi'?'Kh√¥ng ƒë·ªçc ƒë∆∞·ª£c ·∫£nh.':'Cannot read image.');};
  r.readAsDataURL(f);
}

var scanIv=null, scanActive=false;
function startScan(){
  var steps=TEXTS[lang].scanSteps;
  g('scanStepsList').innerHTML=steps.map(function(s,i){
    return '<div class="scan-step-row" id="srow'+i+'">'+
      '<div class="scan-step-ico">'+s.ico+'</div>'+
      '<div class="scan-step-txt">'+s.txt+'</div></div>';
  }).join('');
  g('scanBar').style.width='0%';
  g('scanCard').style.display='block';
  g('detectCard').style.display='none';
  g('modeBadge').className='scan-mode-badge badge-ai';
  g('modeBadge').textContent='üå± GreenSort AI Vision';
  g('scanCard').scrollIntoView({behavior:'smooth',block:'start'});
  scanActive=true;
  var pct=0, step=0;
  scanIv=setInterval(function(){
    if(!scanActive)return;
    pct=Math.min(pct+0.8,88);
    g('scanBar').style.width=pct+'%';
    var newStep=Math.min(Math.floor(pct/20),steps.length-1);
    if(newStep!==step){if(step>=0)g('srow'+step)&&g('srow'+step).classList.add('done');step=newStep;}
    for(var i=0;i<steps.length;i++){var el=g('srow'+i);if(!el)continue;el.classList.remove('active','done');if(i<step)el.classList.add('done');else if(i===step)el.classList.add('active');}
  },60);
}
function stopScan(pct){
  scanActive=false;clearInterval(scanIv);
  g('scanBar').style.width=(pct||100)+'%';
  var steps=TEXTS[lang].scanSteps;
  for(var i=0;i<steps.length;i++){var el=g('srow'+i);if(el)el.classList.add('done');}
  setTimeout(function(){g('scanCard').style.display='none';},600);
}
function switchToSim(){g('modeBadge').className='scan-mode-badge badge-sim';g('modeBadge').textContent=TEXTS[lang].simFallback;}

function showDetection(objName,catName){
  g('detectObj').textContent='üîç '+objName;
  g('detectMapping').textContent=TEXTS[lang].detectMapping;
  g('detectCatChip').textContent=catName;
  g('detectCard').style.display='block';
}

var CAT_MAP={
  'Organic Waste':    {cls:'cat-organic', icon:'üåø'},
  'Recyclable Waste': {cls:'cat-recycle', icon:'‚ôªÔ∏è'},
  'Hazardous Waste':  {cls:'cat-hazard',  icon:'‚ö†Ô∏è'},
  'General Waste':    {cls:'cat-general', icon:'üóëÔ∏è'},
  'Not Waste':        {cls:'cat-notwaste',icon:'üö´'},
  'Ch·∫•t th·∫£i h·ªØu c∆°':       {cls:'cat-organic', icon:'üåø'},
  'Ch·∫•t th·∫£i t√°i ch·∫ø':      {cls:'cat-recycle', icon:'‚ôªÔ∏è'},
  'Ch·∫•t th·∫£i nguy h·∫°i':     {cls:'cat-hazard',  icon:'‚ö†Ô∏è'},
  'Ch·∫•t th·∫£i kh√≥ ph√¢n h·ªßy': {cls:'cat-general', icon:'üóëÔ∏è'},
  'Kh√¥ng ph·∫£i r√°c':         {cls:'cat-notwaste',icon:'üö´'}
};

function showResult(r, isReal){
  var cat=r.category||'';
  var m=CAT_MAP[cat]||{cls:'cat-general',icon:'üóëÔ∏è'};
  var isNW=m.cls==='cat-notwaste';
  var conf=Math.min(Math.max(parseInt(r.confidence)||88,75),99);
  var VI=lang==='vi';
  showDetection(r.object||'?', cat);
  setTimeout(function(){
    g('resultCard').className='result-card '+m.cls;
    g('rIcon').textContent=m.icon;
    g('rCatName').textContent=isNW?(VI?'Kh√¥ng ph·∫£i r√°c':'Not Waste'):cat;
    g('rObj').textContent=r.object||'-';
    g('rMat').textContent=isNW?(VI?'Kh√¥ng √°p d·ª•ng':'N/A'):(r.material||'-');
    g('rCat').textContent=isNW?(VI?'Kh√¥ng ph√¢n lo·∫°i':'Not classified'):cat;
    g('rInstr').textContent=isNW?(VI?'Vui l√≤ng ch·ª•p v·∫≠t l√† r√°c ƒë·ªÉ ph√¢n lo·∫°i.':'Please capture a waste item.'):(r.instruction||'-');
    g('aiNote').textContent=isNW?(VI?'ƒê√¢y kh√¥ng ph·∫£i v·∫≠t c·∫ßn ph√¢n lo·∫°i r√°c.':'This is not a waste item.'):(r.tip||'');
    g('confPct').textContent=conf+'%';
    g('confBar').style.width='0%';
    g('modeTag').innerHTML=isReal
      ?'<span class="scan-mode-badge badge-ai">'+TEXTS[lang].aiReal+'</span>'
      :'<span class="scan-mode-badge badge-sim">'+TEXTS[lang].simFallback+'</span>';
    g('resultSection').style.display='block';
    setTimeout(function(){g('confBar').style.width=conf+'%';},300);
    g('resultSection').scrollIntoView({behavior:'smooth',block:'start'});
    g('btnAnalyze').disabled=false;
  },800);
}

function runSimulation(){
  switchToSim();
  var item=SIM_OBJECTS[Math.floor(Math.random()*SIM_OBJECTS.length)];
  var VI=lang==='vi';
  stopScan(100);
  showResult({object:item.object,material:item.material,category:VI?item.category_vi:item.category_en,instruction:VI?item.instruction_vi:item.instruction_en,tip:VI?item.tip_vi:item.tip_en,confidence:item.confidence},false);
}

function callAI(){

 return fetch('https://greensort-server.onrender.com/analyze',{
  method:'POST',
  headers:{
   'Content-Type':'application/json'
  },
  body:JSON.stringify({
   image: imgBase64,
   mime: imgMime,
   lang: lang
  })
 })

 .then(r=>{
  if(!r.ok) throw new Error("HTTP "+r.status);
  return r.json();
 });

}

function analyze(){

 if(!imgBase64) return;

 g('btnAnalyze').disabled=true;
 g('resultSection').style.display='none';
 g('detectCard').style.display='none';
 g('errBox').style.display='none';

 startScan();

 callAI()

 .then(function(d){

   var r = d.data || d;

   if(!r || !r.object){
     throw new Error("Bad AI response");
   }

   stopScan(100);

   showResult({
     object:r.object,
     material:r.material,
     category:r.category,
     instruction:r.instruction,
     tip:r.tip,
     confidence:r.confidence
   },true);

 })

 .catch(function(err){

   console.log("Retry AI...",err);

   setTimeout(function(){

     callAI()

     .then(function(d){

       var r = d.data || d;

       stopScan(100);

       showResult({
         object:r.object,
         material:r.material,
         category:r.category,
         instruction:r.instruction,
         tip:r.tip,
         confidence:r.confidence
       },true);

     })

     .catch(function(){

       console.log("AI failed ‚Üí Simulation");

       runSimulation();

     });

   },2000);

 });

}

document.addEventListener('click',function(e){
  var devCard=e.target.closest('.dev-member-card');
  if(devCard){
    var key=devCard.getAttribute('data-dev');
    var d=DEV_INFO[key];if(!d)return;
    var L=lang==='vi';
    g('catModalTop').style.background=d.bg;
    g('catModalIco').textContent=d.avatar;
    g('catModalIco').style.fontSize=d.avatar.length>2?'2.5rem':'1rem';
    g('catModalIco').style.fontWeight='900';g('catModalIco').style.color='#fff';
    g('catModalName').textContent=d.name;
    var tags=d.skills.map(function(s){return '<span class="cat-tag">'+s+'</span>';}).join('');
    g('catModalBody').innerHTML=
      '<div class="cat-modal-section"><div class="cat-modal-slbl">'+(L?'Vai tr√≤':'Role')+'</div><div class="cat-modal-sval" style="font-weight:700">'+(L?d.role_vi:d.role_en)+'</div></div>'+
      '<div class="cat-modal-section"><div class="cat-modal-slbl">'+(L?'M√¥ t·∫£':'About')+'</div><div class="cat-modal-sval">'+(L?d.desc_vi:d.desc_en)+'</div></div>'+
      '<div class="cat-modal-section"><div class="cat-modal-slbl">'+(L?'K·ªπ nƒÉng':'Skills')+'</div><div class="cat-modal-tags">'+tags+'</div></div>';
    g('catModalBg').classList.add('open');return;
  }
  var card=e.target.closest('.cat-card:not(.dev-member-card)');if(!card)return;
  var cls=card.getAttribute('data-cls');
  var d2=(CAT_INFO[lang]||{})[cls]||(CAT_INFO['en']||{})[cls];if(!d2)return;
  var t=TEXTS[lang].types.filter(function(x){return x.cls===cls;})[0]||{};
  var L2=lang==='vi';
  g('catModalTop').style.background=d2.bg;
  g('catModalIco').textContent=t.icon||'';g('catModalIco').style.fontSize='3rem';g('catModalIco').style.fontWeight='normal';
  g('catModalName').textContent=t.name||'';
  var tags2=d2.examples.map(function(ex){return '<span class="cat-tag">'+ex+'</span>';}).join('');
  g('catModalBody').innerHTML=
    '<div class="cat-modal-section"><div class="cat-modal-slbl">'+(L2?'M√¥ t·∫£':'Description')+'</div><div class="cat-modal-sval">'+d2.desc+'</div></div>'+
    '<div class="cat-modal-section"><div class="cat-modal-slbl">'+(L2?'V√≠ d·ª•':'Examples')+'</div><div class="cat-modal-tags">'+tags2+'</div></div>'+
    '<div class="cat-modal-section"><div class="cat-modal-slbl">'+(L2?'Th√πng r√°c ƒë√∫ng':'Correct Bin')+'</div><div class="cat-modal-sval" style="font-weight:700">'+d2.bin+'</div></div>'+
    '<div class="cat-modal-section" style="border-left:2px solid '+d2.color+'"><div class="cat-modal-slbl">'+(L2?'M·∫πo':'Tip')+'</div><div class="cat-modal-sval">'+d2.tip+'</div></div>';
  g('catModalBg').classList.add('open');
});
g('catModalClose').addEventListener('click',function(){g('catModalBg').classList.remove('open');});
g('catModalBg').addEventListener('click',function(e){if(e.target===g('catModalBg'))g('catModalBg').classList.remove('open');});

g('segVI').addEventListener('click',function(){setLang('vi');});
g('segEN').addEventListener('click',function(){setLang('en');});
g('segDark').addEventListener('click',function(){setTheme('dark');});
g('segLight').addEventListener('click',function(){setTheme('light');});
g('btnChange').addEventListener('click',function(e){e.stopPropagation();g('fileInput').click();});
g('btnClear').addEventListener('click',function(e){e.stopPropagation();clearImage();});
g('btnAnalyze').addEventListener('click',analyze);
g('uploadZone').addEventListener('click',function(){if(!imgBase64)g('fileInput').click();});
g('fileInput').addEventListener('change',function(e){if(e.target.files[0])onFile(e.target.files[0]);e.target.value='';});
g('fileCam').addEventListener('change',function(e){if(e.target.files[0])onFile(e.target.files[0]);e.target.value='';});

applyLang();
</script>
</body>
</html>
